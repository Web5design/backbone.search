/*! backbone.search - v0.1.0-pre - 2012-10-10
* https://github.com/boazsender/backbone.search
* Copyright (c) 2012 Boaz Sender; Licensed MIT */
(function(a,b){a.Collection.prototype.search=function(b){b=jQuery.trim(b.toLowerCase());var c=new a.Collection;return c.comparator=function(a){return a.get("searchscore")},this.each(function(a){var d=JSON.stringify(a.toJSON()).score(b);d>0&&(a.set("searchscore",d),c.add(a))}),c},String.prototype.score=function(a){if(a.length===0)return.9;if(a.length>this.length)return 0;for(var b=a.length;b>0;b--){var c=a.substring(0,b),d=this.indexOf(c);if(d<0)continue;if(d+a.length>this.length)continue;var e=this.substring(d+c.length),f=null;b>=a.length?f="":f=a.substring(b);var g=e.score(f,d);if(g>0){var h=this.length-e.length;if(d!==0){var i=0,j=this.charCodeAt(d-1);if(j===32||j===9)for(i=d-2;i>=0;i--)j=this.charCodeAt(i),h-=j===32||j===9?1:.15;else h-=d}return h+=g*e.length,h/=this.length,h}}return 0}})(Backbone,_);